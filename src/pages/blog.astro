---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import { getCollection } from 'astro:content';

const blogYazilari = await getCollection('blog');
const siraliYazilar = blogYazilari.sort((a, b) => new Date(b.data.tarih).getTime() - new Date(a.data.tarih).getTime());

// Kategorileri topla (varsa)
const kategoriler = [...new Set(blogYazilari.map(y => y.data.kategori).filter(Boolean))];

// Okuma s√ºresi hesapla (ortalama 200 kelime/dakika)
function hesaplaOkumaSuresi(icerik: string): number {
  const kelimeSayisi = icerik?.split(/\s+/).length || 0;
  return Math.max(1, Math.ceil(kelimeSayisi / 200));
}
---

<Layout title="Blog | Osman Ta≈üdemir">
  <Navbar />
  
  <main>
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-bg-effects">
        <div class="hero-glow hero-glow-1"></div>
        <div class="hero-glow hero-glow-2"></div>
        <div class="particle particle-1"></div>
        <div class="particle particle-2"></div>
        <div class="particle particle-3"></div>
      </div>
      
      <div class="hero-content animate-fade-in">
        <span class="hero-badge">üìù Blog</span>
        <h1>Yazƒ±larƒ±m</h1>
        <p>CBS, uzaktan algƒ±lama ve teknoloji hakkƒ±nda deneyimlerimi payla≈üƒ±yorum.</p>
        
        <!-- Blog ƒ∞statistikleri -->
        <div class="stats-row">
          <div class="stat-item">
            <span class="stat-number">{siraliYazilar.length}</span>
            <span class="stat-label">Yazƒ±</span>
          </div>
          {kategoriler.length > 0 && (
            <>
              <div class="stat-divider"></div>
              <div class="stat-item">
                <span class="stat-number">{kategoriler.length}</span>
                <span class="stat-label">Kategori</span>
              </div>
            </>
          )}
        </div>
      </div>
    </section>

    <!-- Blog Grid -->
    <section class="blog-section">
      <div class="section-transition-top"></div>
      <div class="container">
        
        <!-- Kategori Filtreleri (varsa) -->
        {kategoriler.length > 1 && (
          <div class="filter-bar scroll-animate">
            <button class="filter-btn active" data-filter="all">
              T√ºm√º
            </button>
            {kategoriler.map((kategori) => (
              <button class="filter-btn" data-filter={kategori}>
                {kategori}
              </button>
            ))}
          </div>
        )}
        
        {siraliYazilar.length === 0 ? (
          <div class="empty-state scroll-animate">
            <span class="empty-icon">üìù</span>
            <h3>Hen√ºz yazƒ± yok</h3>
            <p>Yakƒ±nda yeni i√ßerikler eklenecek!</p>
          </div>
        ) : (
          <div class="blog-list">
            {siraliYazilar.map((yazi, index) => (
              <a 
                href={`/blog/${yazi.slug}`} 
                class="blog-card scroll-animate"
                data-category={yazi.data.kategori || ''}
                style={`transition-delay: ${index * 100}ms;`}
              >
                <article>
                  {/* Blog G√∂rseli */}
                  <div class="blog-image">
                    {yazi.data.kapakGorseli ? (
                      <img 
                        src={yazi.data.kapakGorseli} 
                        alt={yazi.data.baslik}
                        loading="lazy"
                      />
                    ) : (
                      <div class="image-placeholder">
                        <span class="placeholder-icon">üìÑ</span>
                      </div>
                    )}
                    <div class="image-overlay"></div>
                  </div>
                  
                  {/* Blog ƒ∞√ßerik */}
                  <div class="blog-content">
                    {/* Meta Bilgiler */}
                    <div class="blog-meta">
                      <time datetime={yazi.data.tarih}>
                        <span class="meta-icon">üìÖ</span>
                        {new Date(yazi.data.tarih).toLocaleDateString('tr-TR', { 
                          year: 'numeric', 
                          month: 'long', 
                          day: 'numeric' 
                        })}
                      </time>
                      {yazi.data.okumaSuresi && (
                        <span class="reading-time">
                          <span class="meta-icon">‚è±Ô∏è</span>
                          {yazi.data.okumaSuresi} dk okuma
                        </span>
                      )}
                    </div>
                    
                    {/* Ba≈ülƒ±k ve √ñzet */}
                    <h2>{yazi.data.baslik}</h2>
                    <p class="blog-excerpt">{yazi.data.ozet}</p>
                    
                    {/* Alt Bilgiler */}
                    <div class="blog-footer">
                      {yazi.data.kategori && (
                        <span class="category-tag">{yazi.data.kategori}</span>
                      )}
                      <span class="read-more">
                        Devamƒ±nƒ± oku
                        <svg class="arrow-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                        </svg>
                      </span>
                    </div>
                  </div>
                </article>
              </a>
            ))}
          </div>
        )}
        
      </div>
    </section>

    <!-- CTA Section -->
    {siraliYazilar.length > 0 && (
      <section class="cta-section">
        <div class="section-transition-top from-blog"></div>
        <div class="cta-content scroll-animate">
          <h2>Bir Projeniz mi Var?</h2>
          <p>CBS ve otomasyon alanƒ±nda birlikte √ßalƒ±≈üabiliriz.</p>
          <a href="/iletisim" class="cta-button">ƒ∞leti≈üime Ge√ß</a>
        </div>
      </section>
    )}

  </main>
</Layout>

<style>
  /* Hero Section */
  .hero-section {
    padding: 160px 20px 80px;
    background: linear-gradient(135deg, #37353E 0%, #1a1a1a 100%);
    position: relative;
    overflow: hidden;
    text-align: center;
  }

  .hero-bg-effects {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .hero-glow {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.15;
  }

  .hero-glow-1 {
    width: 450px;
    height: 450px;
    background: #57564F;
    top: -180px;
    right: 10%;
    animation: pulse-glow 8s ease-in-out infinite;
  }

  .hero-glow-2 {
    width: 350px;
    height: 350px;
    background: #44444E;
    bottom: -120px;
    left: 15%;
    animation: pulse-glow 8s ease-in-out 4s infinite;
  }

  @keyframes pulse-glow {
    0%, 100% { opacity: 0.15; transform: scale(1); }
    50% { opacity: 0.25; transform: scale(1.1); }
  }

  .particle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: #57564F;
    border-radius: 50%;
    opacity: 0.4;
  }

  .particle-1 { top: 25%; left: 12%; animation: float 15s ease-in-out infinite; }
  .particle-2 { top: 50%; right: 18%; animation: float 18s ease-in-out infinite reverse; }
  .particle-3 { bottom: 30%; left: 40%; animation: float 12s ease-in-out infinite; }

  @keyframes float {
    0%, 100% { transform: translateY(0) translateX(0); }
    25% { transform: translateY(-20px) translateX(10px); }
    50% { transform: translateY(-10px) translateX(-10px); }
    75% { transform: translateY(-30px) translateX(5px); }
  }

  .hero-content {
    position: relative;
    z-index: 1;
    max-width: 650px;
    margin: 0 auto;
  }

  .hero-badge {
    display: inline-block;
    background: rgba(87, 86, 79, 0.5);
    color: #D3DAD9;
    padding: 10px 24px;
    border-radius: 30px;
    font-size: 14px;
    margin-bottom: 24px;
    border: 1px solid rgba(211, 218, 217, 0.1);
  }

  .hero-content h1 {
    font-size: 52px;
    font-weight: bold;
    color: #D3DAD9;
    margin-bottom: 16px;
  }

  .hero-content > p {
    font-size: 18px;
    color: #D3DAD9;
    opacity: 0.8;
    line-height: 1.7;
    margin-bottom: 40px;
  }

  /* Stats Row */
  .stats-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
    flex-wrap: wrap;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
  }

  .stat-number {
    font-size: 36px;
    font-weight: bold;
    color: #D3DAD9;
  }

  .stat-label {
    font-size: 14px;
    color: #D3DAD9;
    opacity: 0.6;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .stat-divider {
    width: 1px;
    height: 40px;
    background: rgba(211, 218, 217, 0.2);
  }

  /* Section Transitions */
  .section-transition-top {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100px;
    background: linear-gradient(to bottom, #37353E 0%, transparent 100%);
    pointer-events: none;
  }

  .section-transition-top.from-blog {
    background: linear-gradient(to bottom, #44444E 0%, transparent 100%);
  }

  /* Container */
  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* Blog Section */
  .blog-section {
    padding: 80px 0 100px;
    background-color: #44444E;
    position: relative;
    min-height: 50vh;
  }

  /* Filter Bar */
  .filter-bar {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 50px;
    flex-wrap: wrap;
  }

  .filter-btn {
    background: #37353E;
    color: #D3DAD9;
    border: 2px solid transparent;
    padding: 10px 24px;
    border-radius: 30px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-btn:hover {
    background: #57564F;
    transform: translateY(-2px);
  }

  .filter-btn.active {
    background: #57564F;
    border-color: #D3DAD9;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 80px 20px;
    background: #37353E;
    border-radius: 20px;
  }

  .empty-icon {
    font-size: 64px;
    display: block;
    margin-bottom: 20px;
    opacity: 0.5;
  }

  .empty-state h3 {
    font-size: 24px;
    color: #D3DAD9;
    margin-bottom: 10px;
  }

  .empty-state p {
    color: #D3DAD9;
    opacity: 0.6;
    font-size: 16px;
  }

  /* Blog List */
  .blog-list {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  /* Blog Card */
  .blog-card {
    text-decoration: none;
    display: block;
  }

  .blog-card article {
    background: #37353E;
    border-radius: 16px;
    overflow: hidden;
    display: flex;
    flex-direction: row;
    transition: all 0.4s ease;
    border: 2px solid transparent;
  }

  .blog-card article:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    border-color: rgba(87, 86, 79, 0.5);
  }

  /* Blog Image */
  .blog-image {
    width: 280px;
    min-height: 200px;
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
  }

  .blog-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .blog-card article:hover .blog-image img {
    transform: scale(1.08);
  }

  .image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to right, transparent 0%, rgba(55, 53, 62, 0.3) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .blog-card article:hover .image-overlay {
    opacity: 1;
  }

  .image-placeholder {
    width: 100%;
    height: 100%;
    min-height: 200px;
    background: linear-gradient(135deg, #57564F 0%, #37353E 100%);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .placeholder-icon {
    font-size: 48px;
    opacity: 0.4;
  }

  /* Blog Content */
  .blog-content {
    padding: 28px;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  /* Blog Meta */
  .blog-meta {
    display: flex;
    gap: 20px;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }

  .blog-meta time,
  .blog-meta .reading-time {
    font-size: 13px;
    color: #D3DAD9;
    opacity: 0.6;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .meta-icon {
    font-size: 14px;
  }

  .blog-content h2 {
    font-size: 22px;
    font-weight: bold;
    color: #D3DAD9;
    margin-bottom: 12px;
    transition: color 0.3s ease;
    line-height: 1.4;
  }

  .blog-card article:hover .blog-content h2 {
    color: #fff;
  }

  .blog-excerpt {
    font-size: 15px;
    color: #D3DAD9;
    opacity: 0.7;
    line-height: 1.7;
    flex: 1;
    margin-bottom: 16px;
  }

  /* Blog Footer */
  .blog-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    margin-top: auto;
  }

  .category-tag {
    background: #44444E;
    color: #D3DAD9;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    transition: all 0.3s ease;
  }

  .blog-card article:hover .category-tag {
    background: #57564F;
  }

  .read-more {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #57564F;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .blog-card article:hover .read-more {
    color: #D3DAD9;
  }

  .arrow-icon {
    width: 18px;
    height: 18px;
    transition: transform 0.3s ease;
  }

  .blog-card article:hover .arrow-icon {
    transform: translateX(5px);
  }

  /* CTA Section */
  .cta-section {
    padding: 100px 20px;
    background: linear-gradient(135deg, #37353E 0%, #1a1a1a 100%);
    text-align: center;
    position: relative;
  }

  .cta-content {
    position: relative;
    z-index: 1;
    max-width: 500px;
    margin: 0 auto;
  }

  .cta-section h2 {
    font-size: 32px;
    font-weight: bold;
    color: #D3DAD9;
    margin-bottom: 12px;
  }

  .cta-section p {
    color: #D3DAD9;
    opacity: 0.7;
    font-size: 17px;
    margin-bottom: 30px;
  }

  .cta-button {
    display: inline-block;
    background: #57564F;
    color: #D3DAD9;
    padding: 16px 40px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    font-size: 16px;
    transition: all 0.3s ease;
  }

  .cta-button:hover {
    background: #6a695f;
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(87, 86, 79, 0.3);
  }

  /* Animations */
  .animate-fade-in {
    animation: fadeIn 1s ease-out forwards;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Scroll Animations */
  .scroll-animate {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .scroll-animate.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Filter Animation */
  .blog-card.hidden {
    display: none;
  }

  .blog-card.fade-out {
    opacity: 0;
    transform: scale(0.98);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .hero-content h1 {
      font-size: 36px;
    }

    .blog-card article {
      flex-direction: column;
    }

    .blog-image {
      width: 100%;
      height: 200px;
      min-height: auto;
    }

    .blog-content {
      padding: 24px;
    }

    .blog-content h2 {
      font-size: 20px;
    }

    .blog-footer {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }

    .stats-row {
      gap: 20px;
    }

    .stat-number {
      font-size: 28px;
    }
  }
</style>

<script>
  // Scroll Animation with Intersection Observer
  const observerOptions = {
    root: null,
    rootMargin: '0px',
    threshold: 0.1
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, observerOptions);

  document.addEventListener('DOMContentLoaded', () => {
    const animatedElements = document.querySelectorAll('.scroll-animate');
    animatedElements.forEach(el => observer.observe(el));

    // Filter Functionality (eƒüer filtre varsa)
    const filterButtons = document.querySelectorAll('.filter-btn');
    const blogCards = document.querySelectorAll('.blog-card');

    if (filterButtons.length > 0) {
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          // Update active button
          filterButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');

          const filter = btn.getAttribute('data-filter');

          // Filter cards
          blogCards.forEach(card => {
            const category = card.getAttribute('data-category');
            
            if (filter === 'all' || category === filter) {
              card.classList.remove('hidden');
              card.classList.remove('fade-out');
              setTimeout(() => {
                card.classList.add('visible');
              }, 50);
            } else {
              card.classList.add('fade-out');
              setTimeout(() => {
                card.classList.add('hidden');
              }, 300);
            }
          });
        });
      });
    }
  });

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
</script>