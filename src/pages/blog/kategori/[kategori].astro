---
import Layout from '../../../layouts/Layout.astro';
import Navbar from '../../../components/Navbar.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const blogYazilari = await getCollection('blog');
  
  const tumKategoriler = new Set();
  blogYazilari.forEach(yazi => {
    if (yazi.data.kategori) {
      tumKategoriler.add(yazi.data.kategori.toLowerCase().replace(/\s+/g, '-'));
    }
  });
  
  return Array.from(tumKategoriler).map(kategori => ({
    params: { kategori },
    props: { kategori }
  }));
}

const { kategori } = Astro.props;
const blogYazilari = await getCollection('blog');

const filtrelenmisYazilar = blogYazilari.filter(yazi => 
  yazi.data.kategori?.toLowerCase().replace(/\s+/g, '-') === kategori
).sort((a, b) => new Date(b.data.tarih).getTime() - new Date(a.data.tarih).getTime());

const kategoriAdi = filtrelenmisYazilar[0]?.data.kategori || kategori;
---

<Layout title={`${kategoriAdi} | Blog | Osman Taşdemir`}>
  <Navbar />
  
  <main>
    <section style="padding: 140px 20px 60px; background: linear-gradient(135deg, #37353E 0%, #1a1a1a 100%); text-align: center;">
      <span style="font-size: 14px; color: #7c9a5e; text-transform: uppercase; letter-spacing: 0.1em;">Kategori</span>
      <h1 style="font-size: 42px; font-weight: bold; color: #D3DAD9; margin: 16px 0;">{kategoriAdi}</h1>
      <p style="font-size: 18px; color: #D3DAD9; opacity: 0.7;">
        {filtrelenmisYazilar.length} yazı bulundu
      </p>
    </section>

    <section style="padding: 60px 20px; background-color: #2a2a32; min-height: 50vh;">
      <div style="max-width: 900px; margin: 0 auto;">
        
        {filtrelenmisYazilar.length === 0 ? (
          <p style="text-align: center; color: #D3DAD9; opacity: 0.7;">Bu kategoride yazı bulunamadı.</p>
        ) : (
          <div style="display: flex; flex-direction: column; gap: 24px;">
            {filtrelenmisYazilar.map((yazi) => (
              <a href={`/blog/${yazi.slug}`} style="text-decoration: none;">
                <article style="background: #37353E; border-radius: 12px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; cursor: pointer; display: flex; flex-direction: row;" class="blog-card">
                  {yazi.data.kapakGorseli ? (
                    <img 
                      src={yazi.data.kapakGorseli} 
                      alt={yazi.data.baslik}
                      style="width: 250px; height: 180px; object-fit: cover; flex-shrink: 0;"
                    />
                  ) : (
                    <div style="width: 250px; height: 180px; background: linear-gradient(135deg, #57564F 0%, #37353E 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                      <span style="color: #D3DAD9; opacity: 0.5; font-size: 12px;">Blog Görseli</span>
                    </div>
                  )}
                  <div style="padding: 24px;">
                    <time style="font-size: 14px; color: #57564F; margin-bottom: 8px; display: block;">
                      {new Date(yazi.data.tarih).toLocaleDateString('tr-TR', { year: 'numeric', month: 'long', day: 'numeric' })}
                    </time>
                    <h2 style="font-size: 22px; font-weight: bold; color: #D3DAD9; margin-bottom: 12px;">
                      {yazi.data.baslik}
                    </h2>
                    <p style="font-size: 15px; color: #D3DAD9; opacity: 0.7; line-height: 1.6;">
                      {yazi.data.ozet}
                    </p>
                    <span style="display: inline-block; margin-top: 12px; color: #7c9a5e; font-size: 14px;">
                      Devamını oku →
                    </span>
                  </div>
                </article>
              </a>
            ))}
          </div>
        )}
        
        <div style="text-align: center; margin-top: 40px;">
          <a href="/blog" style="display: inline-flex; align-items: center; gap: 8px; color: #D3DAD9; text-decoration: none; padding: 12px 24px; background: #57564F; border-radius: 8px;">
            ← Tüm Yazılar
          </a>
        </div>
        
      </div>
    </section>
  </main>
</Layout>

<style>
  .blog-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  }
  
  @media (max-width: 600px) {
    .blog-card {
      flex-direction: column !important;
    }
    .blog-card img, .blog-card > div:first-child {
      width: 100% !important;
      height: 200px !important;
    }
  }
</style>
```

