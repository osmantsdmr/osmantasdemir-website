---
interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  headings: Heading[];
  mobile?: boolean;
}

const { headings, mobile = false } = Astro.props;
const filteredHeadings = headings.filter(h => h.depth === 2 || h.depth === 3);
---

{filteredHeadings.length > 0 && (
  <nav class:list={['toc', { 'toc-mobile': mobile }]}>
    {!mobile && (
      <div class="toc-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
        </svg>
        <span>İçindekiler</span>
      </div>
    )}
    <ul class="toc-list">
      {filteredHeadings.map((heading, index) => (
        <li class:list={['toc-item', { 'toc-item-sub': heading.depth === 3 }]}>
          <a href={`#${heading.slug}`} class="toc-link" data-index={index}>
            <span class="toc-indicator"></span>
            <span class="toc-text">{heading.text}</span>
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}

<style>
  .toc {
    background: linear-gradient(135deg, #3a3a42 0%, #2d2d35 100%);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(87, 86, 79, 0.3);
  }
  
  .toc-mobile {
    background: transparent;
    padding: 12px 0 0 0;
    border: none;
  }
  
  .toc-header {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #8a8a8a;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(87, 86, 79, 0.3);
  }
  
  .toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  
  .toc-item-sub {
    margin-left: 16px;
  }
  
  .toc-link {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 8px 12px;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.2s ease;
    color: #9a9a9a;
    font-size: 14px;
    line-height: 1.4;
  }
  
  .toc-item-sub .toc-link {
    font-size: 13px;
    color: #7a7a7a;
  }
  
  .toc-link:hover {
    background: rgba(87, 86, 79, 0.2);
    color: #D3DAD9;
  }
  
  .toc-indicator {
    width: 6px;
    height: 6px;
    min-width: 6px;
    border-radius: 50%;
    background: #4a4a4a;
    margin-top: 6px;
    transition: all 0.2s ease;
  }
  
  .toc-item-sub .toc-indicator {
    width: 4px;
    height: 4px;
    min-width: 4px;
    margin-top: 7px;
  }
  
  .toc-link:hover .toc-indicator {
    background: #57564F;
    transform: scale(1.2);
  }
  
  .toc-link.active {
    background: rgba(87, 86, 79, 0.3);
    color: #fff;
  }
  
  .toc-link.active .toc-indicator {
    background: #7c9a5e;
    box-shadow: 0 0 8px rgba(124, 154, 94, 0.5);
    transform: scale(1.3);
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const tocLinks = document.querySelectorAll('.toc-link');
    const headings = document.querySelectorAll('h2[id], h3[id]');
    
    if (tocLinks.length === 0 || headings.length === 0) return;
    
    tocLinks[0]?.classList.add('active');
    
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.getAttribute('id');
            tocLinks.forEach((link) => link.classList.remove('active'));
            tocLinks.forEach((link) => {
              if (link.getAttribute('href') === `#${id}`) {
                link.classList.add('active');
              }
            });
          }
        });
      },
      { rootMargin: '-80px 0px -70% 0px', threshold: 0 }
    );
    
    headings.forEach((heading) => observer.observe(heading));
  });
</script>